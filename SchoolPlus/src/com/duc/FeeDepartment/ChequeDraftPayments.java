/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * ChequeDraftPayments.java
 *
 * Created on Nov 21, 2009, 8:48:44 PM
 */

package com.duc.FeeDepartment;
import java.sql.*;
import java.text.MessageFormat;
import java.util.HashMap;
import javax.swing.JOptionPane;
import javax.swing.JTable.PrintMode;
import javax.swing.table.DefaultTableModel;
import static com.duc.DatabaseConnection.DatabaseConnection.*;
/**
 *
 * @author Ravi
 */
public class ChequeDraftPayments extends javax.swing.JInternalFrame {
DefaultTableModel dm;
HashMap classmap=mp.getClassIndexName();
    /** Creates new form ChequeDraftPayments */
    public ChequeDraftPayments() {
        initComponents();
        pack();
        System.out.println("con of chequeDraftpayments="+con);
        //this.setLocationRelativeTo(null);
          dm = (DefaultTableModel) jXTable1.getModel();
        dm.setRowCount(0);
        doa.setDateFormat(df);
        fromSession();
          showAllSpecialFeeStudentList();

    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTextPane1 = new javax.swing.JTextPane();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTextPane2 = new javax.swing.JTextPane();
        printButton = new javax.swing.JButton();
        showAllButton = new javax.swing.JButton();
        admissionno = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        sessionCombo = new javax.swing.JComboBox();
        closeButton1 = new javax.swing.JButton();
        jLabel9 = new javax.swing.JLabel();
        doa = new datechooser.beans.DateChooserCombo();
        showAllButton1 = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        jXTable1 = new org.jdesktop.swingx.JXTable();
        closeButton2 = new javax.swing.JButton();

        setClosable(true);
        setIconifiable(true);
        setTitle("Paper Payments List");

        jPanel1.setBackground(new java.awt.Color(0, 153, 153));

        jTextPane1.setBackground(new java.awt.Color(204, 204, 204));
        jTextPane1.setEditable(false);
        jTextPane1.setFont(new java.awt.Font("Tahoma", 0, 24));
        jTextPane1.setText("                                       List of Cheque/Draft Payments");
        jScrollPane2.setViewportView(jTextPane1);

        jTextPane2.setBackground(new java.awt.Color(204, 204, 204));
        jTextPane2.setEditable(false);
        jTextPane2.setFont(new java.awt.Font("Tahoma", 0, 12));
        jTextPane2.setText("It will show the detailded list of Cheque/Drafts payments made by student...");
        jScrollPane3.setViewportView(jTextPane2);

        printButton.setFont(new java.awt.Font("Tahoma", 1, 12));
        printButton.setForeground(new java.awt.Color(0, 0, 255));
        printButton.setText("Print");
        printButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                printButtonActionPerformed(evt);
            }
        });

        showAllButton.setFont(new java.awt.Font("Tahoma", 1, 12));
        showAllButton.setForeground(new java.awt.Color(0, 0, 255));
        showAllButton.setText("Show All");
        showAllButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showAllButtonActionPerformed(evt);
            }
        });

        admissionno.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                admissionnoKeyPressed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 12));
        jLabel1.setText("Admission No.");

        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 12));
        jLabel2.setText("Session");

        sessionCombo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Choose" }));
        sessionCombo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                sessionComboActionPerformed(evt);
            }
        });

        closeButton1.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        closeButton1.setForeground(new java.awt.Color(0, 0, 255));
        closeButton1.setText("Clear");
        closeButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeButton1ActionPerformed(evt);
            }
        });

        jLabel9.setText("Date Wise"); // NOI18N

        doa.setBehavior(datechooser.model.multiple.MultyModelBehavior.SELECT_SINGLE);
        doa.addCursorMoveListener(new datechooser.events.CursorMoveListener() {
            public void onCursorMove(datechooser.events.CursorMoveEvent evt) {
                doaOnCursorMove(evt);
            }
        });
        doa.addCommitListener(new datechooser.events.CommitListener() {
            public void onCommit(datechooser.events.CommitEvent evt) {
                doaOnCommit(evt);
            }
        });
        doa.addSelectionChangedListener(new datechooser.events.SelectionChangedListener() {
            public void onSelectionChange(datechooser.events.SelectionChangedEvent evt) {
                doaOnSelectionChange(evt);
            }
        });

        showAllButton1.setFont(new java.awt.Font("Tahoma", 1, 12));
        showAllButton1.setForeground(new java.awt.Color(0, 0, 255));
        showAllButton1.setText("Show");
        showAllButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showAllButton1ActionPerformed(evt);
            }
        });

        jXTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, "", null, null, null, null, null, new Double(0.0), null, null},
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null}
            },
            new String [] {
                "S. No.", "Id", "Name", "Class", "Pyt. Mode", "Cheque/Draft No.", "Bank Details", "Amt.", "Clear", "Date"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Integer.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.String.class, java.lang.Double.class, java.lang.String.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jXTable1.setColumnControlVisible(true);
        jXTable1.setHorizontalScrollEnabled(true);
        jScrollPane4.setViewportView(jXTable1);

        closeButton2.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        closeButton2.setForeground(new java.awt.Color(0, 0, 255));
        closeButton2.setText("Delete");
        closeButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeButton2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 928, Short.MAX_VALUE)
            .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 928, Short.MAX_VALUE)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 90, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(admissionno, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(39, 39, 39)
                        .addComponent(jLabel9, javax.swing.GroupLayout.DEFAULT_SIZE, 87, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(doa, javax.swing.GroupLayout.PREFERRED_SIZE, 123, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(showAllButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(64, 64, 64)
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(sessionCombo, javax.swing.GroupLayout.PREFERRED_SIZE, 164, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jScrollPane4, 0, 0, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addComponent(printButton, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(showAllButton, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 86, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(closeButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(closeButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(15, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel1)
                        .addComponent(admissionno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(sessionCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel2)
                        .addComponent(showAllButton1))
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel9)
                        .addComponent(doa, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(showAllButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(printButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(closeButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(closeButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 27, Short.MAX_VALUE)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 47, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void printButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_printButtonActionPerformed
        try
        {
        String s="Student Cheque-Draft Payments List";
        MessageFormat header=new MessageFormat(s);
        jXTable1.print(PrintMode.FIT_WIDTH, header, null);
        }

        catch(Exception e)
        {
         System.err.println("Error in printing Cheque-Draft Payments");
        }
        // TODO add your handling code here:
}//GEN-LAST:event_printButtonActionPerformed

    private void showAllButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showAllButtonActionPerformed
        showAllSpecialFeeStudentList();        // TODO add your handling code here:
}//GEN-LAST:event_showAllButtonActionPerformed

    private void admissionnoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_admissionnoKeyPressed
        if(!admissionno.getText().isEmpty())viewSpecialFeeStudentList();     // TODO add your handling code here:
}//GEN-LAST:event_admissionnoKeyPressed

    private void sessionComboActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sessionComboActionPerformed
        sessionWiseChequeDraft();
}//GEN-LAST:event_sessionComboActionPerformed

    private void closeButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeButton1ActionPerformed
clearChequeDD();
 JOptionPane.showConfirmDialog(null,"payment is cleared","payment cearance",JOptionPane.PLAIN_MESSAGE);
// TODO add your handling code here:
    }//GEN-LAST:event_closeButton1ActionPerformed

    private void doaOnCursorMove(datechooser.events.CursorMoveEvent evt) {//GEN-FIRST:event_doaOnCursorMove
        // TODO add your handling code here:
}//GEN-LAST:event_doaOnCursorMove

    private void doaOnCommit(datechooser.events.CommitEvent evt) {//GEN-FIRST:event_doaOnCommit
        // TODO add your handling code here:
}//GEN-LAST:event_doaOnCommit

    private void doaOnSelectionChange(datechooser.events.SelectionChangedEvent evt) {//GEN-FIRST:event_doaOnSelectionChange
        // TODO add your handling code here:
}//GEN-LAST:event_doaOnSelectionChange

    private void showAllButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showAllButton1ActionPerformed
viewSpecialFeeStudentListDateWise();        // TODO add your handling code here:
    }//GEN-LAST:event_showAllButton1ActionPerformed

    private void closeButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeButton2ActionPerformed
    int l=JOptionPane.showConfirmDialog(null,"Want to Remove Selected Payment","Remove alarm",JOptionPane.OK_OPTION);
if(l==0)
        deleteChequeDD();        // TODO add your handling code here:
    }//GEN-LAST:event_closeButton2ActionPerformed

    public void clearChequeDD()
    {

        int row = jXTable1.getSelectedRow();



        try
        {
            ps=con.prepareStatement("update paymentmode set clear=1 where serial=? ");
            ps.setInt(1, Integer.parseInt(dm.getValueAt(row,0).toString()));
            ps.executeUpdate();
        }catch(Exception e)
        {
            e.printStackTrace();
        }
    }


    public void deleteChequeDD()
    {

        int row = jXTable1.getSelectedRow();



        try
        {
            ps=con.prepareStatement("delete from paymentmode where serial=? ");
            ps.setInt(1, Integer.parseInt(dm.getValueAt(row,0).toString()));
            ps.executeUpdate();
            dm.removeRow(row);
            System.out.println("Row is deleted with serial no."+dm.getValueAt(row,0).toString()+"and id="+dm.getValueAt(row,1).toString());
        }catch(Exception e)
        {
            e.printStackTrace();
        }
    }
    public void sessionWiseChequeDraft()
{
     try
       {
           ps = con.prepareStatement("select * from paymentmode left join sessionsetup on session=sessionid where sessiontitle=?");
ps.setString(1,sessionCombo.getSelectedItem().toString());
           rs = ps.executeQuery();
           populateTable(rs);
          
            System.out.println("Database closed");

       }
       catch(Exception e)
       {
           System.err.println("Error"+e);
       }
}

    public void fromSession()
    {
         try
       {
           ps = con.prepareStatement("select sessiontitle,sessionid,status from sessionsetup ");

           rs = ps.executeQuery();
           // int i = 0,j=0;
          while(rs.next())
            {
                //j++;
              sessionCombo.addItem(rs.getString(1));

              if(rs.getInt(3)==1)
                  sessionValue=rs.getInt(2);

            }

         }
         catch(Exception e)
         {
             e.printStackTrace();
    }
   }
 public void populateTable(ResultSet rs)
    {
        int i=0,j=0;
        try
        {
             while(rs.next())
            j++;
        dm.setRowCount(j);
        rs.first();
        rs.previous();
        while(rs.next())
        {
            dm.setValueAt(rs.getInt(1), i,0);
            dm.setValueAt(rs.getString(2), i,1);
            dm.setValueAt(rs.getString(4), i,5);
            dm.setValueAt(rs.getString(5), i,6);
            dm.setValueAt(rs.getDouble(6), i,7);
            if(rs.getInt(9)==0)
             dm.setValueAt("Not Cleared", i,8);
            else 
                dm.setValueAt("Cleared", i,8);
                         dm.setValueAt(rs.getString(7), i,9);

        i++;
        }
rs.first();
        rs.previous();
       //
        i=0;
        while(rs.next())
        {
            if(rs.getInt(3)==1)

            {



            dm.setValueAt("By Cheque", i, 4);


        }

             if(rs.getInt(3)==2)

            {


            dm.setValueAt("By DD", i, 4);


        }
  ps1=con.prepareStatement("select * from studententry where id=?");
        ps1.setString(1,rs.getString(2));
        rs2=ps1.executeQuery();
            rs2.next();
             dm.setValueAt(rs2.getString(2), i,2);
            dm.setValueAt(classmap.get(rs2.getInt(9)), i,3);


     i++;    }
        }catch(Exception e)
        {
e.printStackTrace();
        }
    }
public void showAllSpecialFeeStudentList()
{

   // con= com.duc.DatabaseConnection.DatabaseConnection.con;
  //  int i=0,j=0;
    try
    {
        ps=con.prepareStatement("select * from paymentmode where session=?");
        ps.setInt(1,sessionValue);
        rs=ps.executeQuery();

        populateTable(rs);

    }catch(Exception e)
    {
e.printStackTrace();
    }




}

public void viewSpecialFeeStudentList()
   {
      //con= com.duc.DatabaseConnection.DatabaseConnection.con;
    int i=0,j=0;
    try
    {
        ps=con.prepareStatement("select * from paymentmode where studentid=?");
        ps.setString(1, admissionno.getText());
        rs=ps.executeQuery();
       populateTable(rs);
    }catch(Exception e)
    {
e.printStackTrace();
    }



   }

public void viewSpecialFeeStudentListDateWise()
   {
      //con= com.duc.DatabaseConnection.DatabaseConnection.con;
    int i=0,j=0;
    try
    {
        ps=con.prepareStatement("select * from paymentmode where date=?");
        ps.setString(1, doa.getText());
        rs=ps.executeQuery();
       populateTable(rs);
    }catch(Exception e)
    {
e.printStackTrace();
    }



   }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField admissionno;
    private javax.swing.JButton closeButton1;
    private javax.swing.JButton closeButton2;
    private datechooser.beans.DateChooserCombo doa;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JTextPane jTextPane1;
    private javax.swing.JTextPane jTextPane2;
    private org.jdesktop.swingx.JXTable jXTable1;
    private javax.swing.JButton printButton;
    private javax.swing.JComboBox sessionCombo;
    private javax.swing.JButton showAllButton;
    private javax.swing.JButton showAllButton1;
    // End of variables declaration//GEN-END:variables
//Connection con;
PreparedStatement ps,ps1;
ResultSet rs,rs1,rs2;
public Integer sessionValue;
}
